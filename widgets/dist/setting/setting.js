System.register(["jimu-core","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/setting-components","jimu-ui"],(function(e,t){var o={},a={},n={},s={};return{setters:[function(e){o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.React=e.React},function(e){a.DataSourceSelector=e.DataSourceSelector},function(e){n.MapWidgetSelector=e.MapWidgetSelector},function(e){s.Button=e.Button}],execute:function(){e((()=>{var e={89:e=>{"use strict";e.exports=a},244:e=>{"use strict";e.exports=o},298:e=>{"use strict";e.exports=n},321:e=>{"use strict";e.exports=s}},t={};function r(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,r),n.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{__set_webpack_public_path__:()=>u,default:()=>c});var e=r(244),t=r(89),o=r(298),a=r(321),n=function(e,t,o,a){return new(o||(o=Promise))((function(n,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};let s=null;class c extends e.React.PureComponent{constructor(){super(...arguments),this.state={toastMessage:"",toastVisible:!1},this.supportedTypes=(0,e.Immutable)([e.DataSourceTypes.FeatureLayer]),this.onDataSourceChange=t=>{this.props.onSettingChange({id:this.props.id,useDataSources:t});const o=t.map((e=>e.dataSourceId)).filter((e=>Boolean(e)));this.props.onSettingChange({id:this.props.id,config:this.props.config.set("layerIds",(0,e.Immutable)(o))})},this.handleSendClick=()=>n(this,void 0,void 0,(function*(){const t=this.props.useDataSources||[],o=e.DataSourceManager.getInstance(),a=t.map((e=>{var t,a;const n=o.getDataSource(e.dataSourceId),s=(null===(a=(t=n).getConfig)||void 0===a?void 0:a.call(t))||{};return{id:e.dataSourceId,title:"function"==typeof n.getLabel?n.getLabel():s.label||e.dataSourceId,type:"function"==typeof n.getDataSourceType?n.getDataSourceType():s.dataSourceType||"FeatureLayer",url:s.url||null}})),n=function(e){const t=JSON.stringify(e);return t===s?(console.log("\u{1f501} Contexto igual al anterior, no se env\xeda."),!1):(s=t,console.log("\u{1f680} Contexto ENVIADO desde Settings:",e),!0)}({layers:a,functions:["FILTER_LAYERS","FILTER_BY_FIELD"]});if(n)try{const e=yield fetch("http://127.0.0.1:8000/context",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({layers:a,functions:["FILTER_LAYERS","FILTER_BY_FIELD"]})});e.ok||console.error("Error al guardar contexto:",e.statusText)}catch(e){console.error("Fallo en fetch /context:",e)}const r=n?"Contexto enviado correctamente":"Contexto duplicado, no se env\xeda";this.showToast(r)})),this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e})}}showToast(e){this.setState({toastMessage:e,toastVisible:!0}),setTimeout((()=>{this.setState({toastVisible:!1})}),3e3)}render(){const{toastMessage:n,toastVisible:s}=this.state;return e.React.createElement("div",{className:"p-3",style:{position:"relative"}},e.React.createElement("div",{className:"jimu-widget-setting--map-selector mb-3"},e.React.createElement(o.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:this.props.useMapWidgetIds})),e.React.createElement(t.DataSourceSelector,{mustUseDataSource:!0,types:this.supportedTypes,useDataSources:this.props.useDataSources,onChange:this.onDataSourceChange,widgetId:this.props.id,isMultiple:!0}),e.React.createElement("div",{className:"mt-3"},e.React.createElement(a.Button,{onClick:this.handleSendClick,title:"Enviar contexto"},"\u{1f916} Enviar contexto")),s&&e.React.createElement("div",{style:{position:"absolute",bottom:20,right:20,background:"rgba(0,0,0,0.75)",color:"#fff",padding:"8px 12px",borderRadius:"4px",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",zIndex:1e3}},n))}}function u(e){r.p=e}})(),i})())}}}));